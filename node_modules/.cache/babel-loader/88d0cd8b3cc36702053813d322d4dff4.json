{"ast":null,"code":"'use strict';\n\nvar SOUNDCLOUD_API_URL = 'https://api.soundcloud.com';\nvar anchor;\nvar keys = 'protocol hostname host pathname port search hash href'.split(' ');\n\nfunction _parseURL(url) {\n  if (!anchor) {\n    anchor = document.createElement('a');\n  }\n\n  var result = {};\n  anchor.href = url || '';\n\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    result[key] = anchor[key];\n  }\n\n  return result;\n}\n\nfunction _appendQueryParam(url, param, value) {\n  var U = _parseURL(url);\n\n  var regex = /\\?(?:.*)$/;\n  var chr = regex.test(U.search) ? '&' : '?';\n  var result = U.protocol + '//' + U.host + U.port + U.pathname + U.search + chr + param + '=' + value + U.hash;\n  return result;\n}\n\nfunction SoundCloud(clientId, apiUrl) {\n  if (!(this instanceof SoundCloud)) {\n    return new SoundCloud(clientId, apiUrl);\n  }\n\n  if (!clientId && !apiUrl) {\n    console.info('SoundCloud API requires clientId or custom apiUrl');\n  }\n\n  this._events = {};\n  this._clientId = clientId;\n  this._baseUrl = apiUrl || SOUNDCLOUD_API_URL;\n  this.playing = false;\n  this.duration = 0;\n  this.audio = document.createElement('audio');\n}\n\nSoundCloud.prototype.resolve = function (url, callback) {\n  var resolveUrl = this._baseUrl + '/resolve.json?url=' + encodeURIComponent(url);\n\n  if (this._clientId) {\n    resolveUrl = _appendQueryParam(resolveUrl, 'client_id', this._clientId);\n  }\n\n  this._json(resolveUrl, function (data) {\n    this.cleanData();\n\n    if (Array.isArray(data)) {\n      data = {\n        tracks: data\n      };\n    }\n\n    if (data.tracks) {\n      data.tracks = data.tracks.map(this._transformTrack.bind(this));\n      this._playlist = data;\n    } else {\n      this._track = this._transformTrack(data); // save timings\n\n      var U = _parseURL(url);\n\n      this._track.stream_url += U.hash;\n    }\n\n    this.duration = data.duration && !isNaN(data.duration) ? data.duration / 1000 // convert to seconds\n    : 0; // no duration is zero\n\n    callback(data);\n  }.bind(this));\n}; // deprecated\n\n\nSoundCloud.prototype._jsonp = function (url, callback) {\n  var target = document.getElementsByTagName('script')[0] || document.head;\n  var script = document.createElement('script');\n  var id = 'jsonp_callback_' + new Date().valueOf() + Math.floor(Math.random() * 1000);\n\n  window[id] = function (data) {\n    if (script.parentNode) {\n      script.parentNode.removeChild(script);\n    }\n\n    window[id] = function () {};\n\n    callback(data);\n  };\n\n  script.src = _appendQueryParam(url, 'callback', id);\n  target.parentNode.insertBefore(script, target);\n};\n\nSoundCloud.prototype._json = function (url, callback) {\n  var xhr = new XMLHttpRequest();\n  xhr.open('GET', url);\n\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        var resp = {};\n\n        try {\n          resp = JSON.parse(xhr.responseText);\n        } catch (err) {// fail silently\n        }\n\n        callback(resp);\n      }\n    }\n  };\n\n  xhr.send(null);\n};\n\nSoundCloud.prototype._transformTrack = function (track) {\n  if (this._baseUrl !== SOUNDCLOUD_API_URL) {\n    track.original_stream_url = track.stream_url;\n    track.stream_url = track.stream_url.replace(SOUNDCLOUD_API_URL, this._baseUrl);\n  }\n\n  return track;\n};\n\nSoundCloud.prototype.on = function (e, fn) {\n  this._events[e] = fn;\n  this.audio.addEventListener(e, fn, false);\n};\n\nSoundCloud.prototype.off = function (e, fn) {\n  this._events[e] = null;\n  this.audio.removeEventListener(e, fn);\n};\n\nSoundCloud.prototype.unbindAll = function () {\n  for (var e in this._events) {\n    var fn = this._events[e];\n\n    if (fn) {\n      this.off(e, fn);\n    }\n  }\n};\n\nSoundCloud.prototype.preload = function (streamUrl, preloadType) {\n  this._track = {\n    stream_url: streamUrl\n  };\n\n  if (preloadType) {\n    this.audio.preload = preloadType;\n  }\n\n  this.audio.src = this._clientId ? _appendQueryParam(streamUrl, 'client_id', this._clientId) : streamUrl;\n};\n\nSoundCloud.prototype.play = function (options) {\n  options = options || {};\n  var src;\n\n  if (options.streamUrl) {\n    src = options.streamUrl;\n  } else if (this._playlist) {\n    var length = this._playlist.tracks.length;\n\n    if (length) {\n      if (options.playlistIndex === undefined) {\n        this._playlistIndex = this._playlistIndex || 0;\n      } else {\n        this._playlistIndex = options.playlistIndex;\n      } // be silent if index is out of range\n\n\n      if (this._playlistIndex >= length || this._playlistIndex < 0) {\n        this._playlistIndex = 0;\n        return;\n      }\n\n      src = this._playlist.tracks[this._playlistIndex].stream_url;\n    }\n  } else if (this._track) {\n    src = this._track.stream_url;\n  }\n\n  if (!src) {\n    throw new Error('There is no tracks to play, use `streamUrl` option or `load` method');\n  }\n\n  if (this._clientId) {\n    src = _appendQueryParam(src, 'client_id', this._clientId);\n  }\n\n  if (src !== this.audio.src) {\n    this.audio.src = src;\n  }\n\n  this.playing = src;\n  return this.audio.play();\n};\n\nSoundCloud.prototype.pause = function () {\n  this.audio.pause();\n  this.playing = false;\n};\n\nSoundCloud.prototype.stop = function () {\n  this.audio.pause();\n  this.audio.currentTime = 0;\n  this.playing = false;\n};\n\nSoundCloud.prototype.next = function (options) {\n  options = options || {};\n  var tracksLength = this._playlist.tracks.length;\n\n  if (this._playlistIndex >= tracksLength - 1) {\n    if (options.loop) {\n      this._playlistIndex = -1;\n    } else {\n      return;\n    }\n  }\n\n  if (this._playlist && tracksLength) {\n    return this.play({\n      playlistIndex: ++this._playlistIndex\n    });\n  }\n};\n\nSoundCloud.prototype.previous = function () {\n  if (this._playlistIndex <= 0) {\n    return;\n  }\n\n  if (this._playlist && this._playlist.tracks.length) {\n    return this.play({\n      playlistIndex: --this._playlistIndex\n    });\n  }\n};\n\nSoundCloud.prototype.seek = function (e) {\n  if (!this.audio.readyState) {\n    return false;\n  }\n\n  var percent = e.offsetX / e.target.offsetWidth || (e.layerX - e.target.offsetLeft) / e.target.offsetWidth;\n  this.audio.currentTime = percent * (this.audio.duration || 0);\n};\n\nSoundCloud.prototype.cleanData = function () {\n  this._track = void 0;\n  this._playlist = void 0;\n};\n\nSoundCloud.prototype.setVolume = function (volumePercentage) {\n  if (!this.audio.readyState) {\n    return;\n  }\n\n  this.audio.volume = volumePercentage;\n};\n\nSoundCloud.prototype.setTime = function (seconds) {\n  if (!this.audio.readyState) {\n    return;\n  }\n\n  this.audio.currentTime = seconds;\n};\n\nmodule.exports = SoundCloud;","map":null,"metadata":{},"sourceType":"script"}